<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>GeoJSONApp-ext02</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- Le favicon -->
    <link rel="shortcut icon" type="image/png" href="">
    
    <!-- Le styles -->
    <!-- own css-->
    <link rel="stylesheet" type="text/css" href="/UsingUnfolding/assets/css/main.css">
    <link rel="stylesheet" type="text/css" href="/UsingUnfolding/assets/css/pygmentsstyle.css">
    <link rel="stylesheet" type="text/css" href="/UsingUnfolding/assets/css/lightbox.css">
</head>
    <body id="GeoJSONApp-ext02">
        <div class="container">
            <div class="span10 offset1">
                <div class="row">
                    <div class="span8">
                        <h1>GEOJSONAPP-EXT02</h1>
                    </div>
                    <div class="span2 hidden-phone">
                        <ul id="dlbuttons">
    <li>
        <a href="https://github.com/PDXIII/UsingUnfolding/zipball/master">
            .zip
        </a>
    </li>
    <li>
        <a href="https://github.com/PDXIII/UsingUnfolding/tarball/master">
            .tar
        </a>
    </li>
    <li>
        <a href="https://github.com/PDXIII/UsingUnfolding">
            github
        </a>
    </li>
</ul>
                    </div>
                </div>
                <div class="row">
                    <ul class="nav">
  <li>
    <a class="span2" href="/UsingUnfolding/index.html">Home</a>
  </li>
  <li>
    <a class="span2" href="#">Link</a>
  </li>
  <li class="dropdown span2">
    <a id="GJA" role="button" class="dropdown-toggle" data-toggle="dropdown" href="#">
      GeoJSONApp
    </a>
    <ul class="dropdown-menu" role="menu" aria-labelledby="GJA">
      
      
        <li>
          <a tabindex="-1" href="/UsingUnfolding/GeoJSONApp-basic.html">
            GeoJSONApp-basic
          </a>
        </li>
      
      
      
        <li>
          <a tabindex="-1" href="/UsingUnfolding/GeoJSONApp-ext01.html">
            GeoJSONApp-ext01
          </a>
        </li>
      
      
      
        <li>
          <a tabindex="-1" href="/UsingUnfolding/GeoJSONApp-ext02.html">
            GeoJSONApp-ext02
          </a>
        </li>
      
      
      
      
    </ul>
  </li>
</ul>
<!-- /nav -->
                </div>
                <div class="row">
                <div class="span10">
                    <h2>BlaBla</h2>
                    </div>
                </div>
                <p>Now let's lay hand on the airports. To get an easy entry please insert thes lines at the end of your <code>setup()</code> function:</p>

<div class="highlight"><pre><code class="java">    <span class="n">List</span><span class="o">&lt;</span><span class="n">Feature</span><span class="o">&gt;</span> <span class="n">airports</span> <span class="o">=</span> <span class="n">GeoJSONReader</span><span class="o">.</span><span class="na">loadData</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">&quot;WorldAirports.geo.json&quot;</span><span class="o">);</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Marker</span><span class="o">&gt;</span> <span class="n">airportMarkers</span> <span class="o">=</span> <span class="n">MapUtils</span><span class="o">.</span><span class="na">createSimpleMarkers</span><span class="o">(</span><span class="n">airports</span><span class="o">);</span>
    <span class="n">map</span><span class="o">.</span><span class="na">addMarkers</span><span class="o">(</span><span class="n">airportMarkers</span><span class="o">);</span>
</code></pre>
</div>


<p><strong>And run!</strong></p>

<p>There are quite a lot of airports to display and it seems to me like a little loss of performance. And remember that we just want to see the airports of the country we are hovering. First of all we have to make the same changes on the airports stuff, that we made on the countries stuff: make the <code>Markers</code> global and don't add them to the <code>map</code>.</p>

<p>If you are done, let's think about, how we should handle the airports. My suggestion is to sort them into <code>ArrayLists</code> for each country one. Then we only have to call for that ArrayList and tell each airport inside to draw itself. Would be nice if this sorting could be done in advance, but the <em>WorldAirports.geo.json</em> lacks of meta information (properites), and the <a href="http://unfoldingmaps.org/">Unfolding library</a> needs to draw a map to compare the locations of two features. Therefore we must do the sorting one time during runtime. Please, make a global boolean an set it on false:</p>

<pre><code>boolean airportListsBuild = false;
</code></pre>

<p>Then go into your <code>draw()</code> function and make an <code>if-else</code> statement under the <code>map.draw()</code> that executes when the boolean is false.</p>

<div class="highlight"><pre><code class="java">    <span class="k">if</span><span class="o">(!</span><span class="n">airportListsBuild</span><span class="o">){</span>

    <span class="o">}</span>
    <span class="k">else</span><span class="o">{</span>
      
    <span class="o">}</span>
</code></pre>
</div>


<p>And put all code below this statement between the else brackets.</p>

<p><strong>Run!</strong></p>

<p>You should neither have an error nor any hover effect or output. Because all this will only work when <code>airportsListsBuild</code> is true. Meanwhile we'll do the sorting and we are going to to this with an own function.</p>

<p>So please insert a global <code>ArrayList&lt;ArrayList&gt; airportLists</code>, then edit your if-statement like this:</p>

<div class="highlight"><pre><code class="java">    <span class="k">if</span><span class="o">(!</span><span class="n">airportListsBuild</span><span class="o">){</span>
      <span class="n">airportLists</span> <span class="o">=</span> <span class="n">makeAirportLists</span><span class="o">(</span><span class="n">map</span><span class="o">,</span> <span class="n">countryMarkers</span><span class="o">,</span> <span class="n">airportMarkers</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre>
</div>


<p>this calls the function with the necessary parameters. Then make this new function under your draw() function:</p>

<div class="highlight"><pre><code class="java">    <span class="n">ArrayList</span> <span class="o">&lt;</span><span class="n">ArrayList</span><span class="o">&gt;</span> <span class="n">makeAirportLists</span><span class="o">(</span>
        <span class="n">UnfoldingMap</span> <span class="n">map</span><span class="o">,</span> 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Marker</span><span class="o">&gt;</span> <span class="n">countryMarkers</span><span class="o">,</span> 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Marker</span><span class="o">&gt;</span> <span class="n">airportMarkers</span><span class="o">){</span>
          <span class="n">ArrayList</span> <span class="o">&lt;</span><span class="n">ArrayList</span><span class="o">&gt;</span> <span class="n">lists</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">();</span>
          <span class="n">airportListsBuild</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
          <span class="k">return</span> <span class="n">lists</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre>
</div>


<p>This function receives the parameters, makes a <code>new ArrayList</code>, sets our <code>boolean</code> to <code>true</code> and returns the <code>ArrayList</code>.</p>

<p><strong>Run!</strong></p>

<p>As you can see, our known interactions are back again, because when the function is called our <code>boolean</code> is set to <code>true</code> and the <code>else</code> part of our <code>if</code>-statement is executed.</p>

<p>Now let's start sorting. For every country we want to check if there are any airports and put them into a list for each country.</p>

<p>Let's see:</p>

<div class="highlight"><pre><code class="java">    <span class="n">ArrayList</span> <span class="o">&lt;</span><span class="n">ArrayList</span><span class="o">&gt;</span> <span class="n">makeAirportLists</span><span class="o">(</span>
        <span class="n">UnfoldingMap</span> <span class="n">map</span><span class="o">,</span> 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Marker</span><span class="o">&gt;</span> <span class="n">countryMarkers</span><span class="o">,</span> 
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Marker</span><span class="o">&gt;</span> <span class="n">airportMarkers</span><span class="o">){</span>

      <span class="n">ArrayList</span> <span class="o">&lt;</span><span class="n">ArrayList</span><span class="o">&gt;</span> <span class="n">lists</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">();</span>

      <span class="c1">// iterating through the countryMarkers</span>
      <span class="k">for</span> <span class="o">(</span><span class="n">Marker</span> <span class="n">country</span> <span class="o">:</span> <span class="n">countryMarkers</span><span class="o">){</span>

        <span class="c1">// a new ArrayList for each country</span>
        <span class="n">ArrayList</span> <span class="n">currentMarkerList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">();</span>

        <span class="c1">// iterating through the airportMarkers</span>
        <span class="k">for</span> <span class="o">(</span><span class="n">Marker</span> <span class="n">airport</span> <span class="o">:</span> <span class="n">airportMarkers</span><span class="o">){</span>

          <span class="c1">// we need to get the Loction of the airport</span>
          <span class="n">Location</span> <span class="n">airportLocation</span> <span class="o">=</span> <span class="n">airport</span><span class="o">.</span><span class="na">getLocation</span><span class="o">();</span>

          <span class="c1">// we need do convert it into a ScreenPosition</span>
          <span class="n">ScreenPosition</span> <span class="n">airportScreenPos</span> <span class="o">=</span> <span class="n">map</span><span class="o">.</span><span class="na">getScreenPosition</span><span class="o">(</span><span class="n">airportLocation</span><span class="o">);</span>

          <span class="c1">// and if this ScreenPosition is inside the country</span>
          <span class="k">if</span><span class="o">(</span><span class="n">country</span><span class="o">.</span><span class="na">isInside</span><span class="o">(</span><span class="n">map</span><span class="o">,</span> <span class="n">airportScreenPos</span><span class="o">.</span><span class="na">x</span><span class="o">,</span> <span class="n">airportScreenPos</span><span class="o">.</span><span class="na">y</span><span class="o">)){</span>

            <span class="c1">// we add the Marker to this ArrayList</span>
            <span class="n">currentMarkerList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">airport</span><span class="o">);</span>
          <span class="o">}</span>
        <span class="o">}</span>
        <span class="c1">// we add this ArrayList of Markers to our ArrayList of ArrayLists</span>
        <span class="n">lists</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">currentMarkerList</span><span class="o">);</span>

        <span class="c1">// to see if the program is running we generate some output</span>
        <span class="n">println</span><span class="o">(</span><span class="n">lists</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
      <span class="o">}</span>
      <span class="n">airportListsBuild</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
      <span class="k">return</span> <span class="n">lists</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre>
</div>


<p>Now we have a good structure, so let's play with it. We need to edit the <code>else</code> section in our <code>draw()</code> function after the <code>println(countryName)</code>:</p>

<div class="highlight"><pre><code class="java">    <span class="c1">// we need to get right the airport list for the current country</span>
    <span class="c1">// because airportLists is sorted after the coutries i calls the right one</span>
    <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Marker</span><span class="o">&gt;</span> <span class="n">currentAirportList</span> <span class="o">=</span> <span class="n">airportLists</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>

    <span class="c1">// iterating through this airport list</span>
    <span class="k">for</span> <span class="o">(</span><span class="n">Marker</span> <span class="n">currentAirport</span> <span class="o">:</span> <span class="n">currentAirportList</span> <span class="o">){</span>

      <span class="c1">// tell airport to draw itself</span>
      <span class="n">currentAirport</span><span class="o">.</span><span class="na">draw</span><span class="o">(</span><span class="n">map</span><span class="o">);</span>

      <span class="c1">// check for mouse hover</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">currentAirport</span><span class="o">.</span><span class="na">isInside</span><span class="o">(</span><span class="n">map</span><span class="o">,</span> <span class="n">mouseX</span><span class="o">,</span> <span class="n">mouseY</span><span class="o">)){</span>

        <span class="c1">// you should know this from the countries part</span>
        <span class="n">HashMap</span> <span class="n">currentAirportProps</span> <span class="o">=</span> <span class="n">currentAirport</span><span class="o">.</span><span class="na">getProperties</span><span class="o">();</span>

        <span class="c1">// Note: in this case &quot;NAME&quot; is written in uppercase,</span>
        <span class="c1">// this depends on the given geo.json file</span>
        <span class="c1">// it&#39;s better to know your data</span>
        <span class="n">String</span> <span class="n">currentAirportName</span> <span class="o">=</span> <span class="n">currentAirportProps</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">&quot;NAME&quot;</span><span class="o">).</span><span class="na">toString</span><span class="o">();</span>

        <span class="c1">// string output into the console</span>
        <span class="n">println</span><span class="o">(</span><span class="n">currentAirportName</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>
</code></pre>
</div>


<h2>Style</h2>

<p>Now it's time to get rid of the gray and add a little style, but you should do this on your own. For more tutorials concerning this and other topics, please visit <a href="http://unfoldingmaps.org/tutorials/index.html">Unfolding tutorials</a>.</p>

<div id="gallery" class="row">
    <ul>
      
        <li class="span2">
            <a href="/UsingUnfolding/assets/images/GeoJSONApp-ext02-1.png" rel="lightbox[GeoJSONApp-ext02]">
                <img src="/UsingUnfolding/assets/images/thumbs/GeoJSONApp-ext02-1.png"/>
            </a>
        </li>
        
        <li class="span2">
            <a href="/UsingUnfolding/assets/images/GeoJSONApp-ext02-2.png" rel="lightbox[GeoJSONApp-ext02]">
                <img src="/UsingUnfolding/assets/images/thumbs/GeoJSONApp-ext02-2.png"/>
            </a>
        </li>
        
        <li class="span2">
            <a href="/UsingUnfolding/assets/images/GeoJSONApp-ext02-3.png" rel="lightbox[GeoJSONApp-ext02]">
                <img src="/UsingUnfolding/assets/images/thumbs/GeoJSONApp-ext02-3.png"/>
            </a>
        </li>
        
        <li class="span2">
            <a href="/UsingUnfolding/assets/images/GeoJSONApp-ext02-4.png" rel="lightbox[GeoJSONApp-ext02]">
                <img src="/UsingUnfolding/assets/images/thumbs/GeoJSONApp-ext02-4.png"/>
            </a>
        </li>
        
        <li class="span2">
            <a href="/UsingUnfolding/assets/images/GeoJSONApp-ext02-5.png" rel="lightbox[GeoJSONApp-ext02]">
                <img src="/UsingUnfolding/assets/images/thumbs/GeoJSONApp-ext02-5.png"/>
            </a>
        </li>
        
    </ul>
</div>





<div class="row">
    <ul class="nav">
  
  <li>
    <a class="span2" href="/UsingUnfolding/GeoJSONApp-ext01.html">Previous</a>
  </li>
  
  <li>
    <a class="span2" href="/UsingUnfolding/index.html">Top</a>
  </li>
    
</ul>
<!-- /nav -->
</div>
                <br />
                <br />

            </div>
        </div>

            <!-- Le javascript
        ================================================== -->
        <!-- Placed at the end of the document so the pages load faster -->
        <script src="http://code.jquery.com/jquery-latest.min.js"></script>
        <script>window.jQuery || document.write('<script src="/UsingUnfolding/assets/js/jquery-1.8.2.min.js"><\/script>')</script>
        <script type="text/javascript" src="/UsingUnfolding/assets/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="/UsingUnfolding/assets/js/lightbox.js"></script>
        <script type="text/javascript" src="/UsingUnfolding/assets/js/main.js"></script>

        <!-- own scripts-->
    </body>
</html>
